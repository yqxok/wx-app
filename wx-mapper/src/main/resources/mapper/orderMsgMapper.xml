<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pri.yqx.mapper.OrderMsgMapper">


    <select id="getOrderMsgVo" resultType="pri.yqx.vo.OrderMsgVo">
        select m.content, m.is_read,m.order_msg_id, m.order_id,o.good_id,m.sender_id,m.receiver_id,o.html,o.pic_url,u.profile_pic_url,u.user_name,m.status,m.create_time
        from wx_order_msg m inner join wx_good_order o on m.order_id=o.order_id inner join wx_user u on m.sender_id=u.user_id
        where m.order_msg_id=#{orderMsgId}
    </select>

    <select id="getOrderMsgVoList" resultType="pri.yqx.vo.OrderMsgVo">
        select m.content,m.is_read,m.order_msg_id,m.order_id,o.good_id,m.sender_id,m.receiver_id,o.html,o.pic_url,u.profile_pic_url,u.user_name,m.status,m.create_time
        from wx_order_msg m inner join wx_good_order o on m.order_id=o.order_id inner join wx_user u on m.sender_id=u.user_id
        where m.receiver_id=#{userId} order by m.create_time desc
    </select>
    <select id="getOrderMsgCountVo" resultType="pri.yqx.vo.OrderMsgCountVo">
        select m.create_time,m.content,m1.noReadNum from wx_order_msg m
        inner join (select count(case when msg.is_read=false then 1 end) noReadNum,msg.receiver_id from wx_order_msg msg group by msg.receiver_id having msg.receiver_id=#{userId}) m1
        on m.receiver_id=m1.receiver_id  order by m.create_time desc limit 1;
    </select>

</mapper>